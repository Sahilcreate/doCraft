<% const {editTaskForm, goals, tags, task, errors} = content %>
<div class="bg-gray-100 flex flex-col items-center py-10 px-4">
    <% if (errors) { %>
  <div class="bg-red-100 text-red-800 p-3 rounded-md mb-4">
    <ul class="list-disc pl-5">
      <% errors.forEach(error => { %>
      <li><%= error.msg %></li>
      <% }) %>
    </ul>
  </div>
  <% } %>
  <div class="form-card w-full max-w-2xl bg-white p-6 rounded-lg shadow-md space-y-4">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <button
        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-sm rounded-md transition cursor-pointer"
        onClick="history.back()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 inline-block mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        Go Back
      </button>
      <h2 class="text-xl font-semibold text-gray-800">
        <%= editTaskForm ? "Edit Task" : "Create New Task" %>
      </h2>
    </div>

    <% const formAction = editTaskForm ? `/tasks/${task.task_id}/form` : '/tasks/form' %>
    <form action="<%= formAction %>" method="post" class="space-y-4">

      <!-- Title -->
      <div>
        <label for="title" class="block font-semibold text-gray-700 mb-1">Title</label>
        <input
          type="text"
          id="title"
          name="title"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 hover:outline-1"
          value="<%= editTaskForm ? task.task_title : '' %>"
          required
        />
      </div>


      <!-- Description -->
      <div>
        <label for="description" class="block font-semibold text-gray-700 mb-1">Description</label>
        <input
          type="text"
          id="description"
          name="description"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 hover:outline-1"
          value="<%= editTaskForm ? task.task_description : '' %>"
          required
        />
      </div>

      <!-- Goal Dropdown -->
      <div>
        <label for="goals" class="block font-semibold text-gray-700 mb-1">Select Goal</label>
        <select
          name="goals"
          id="goals"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 hover:outline-1"
          required
        >
          <% goals.forEach(goal => { %>
            <option
              value="<%= goal.id %>"
              <%= editTaskForm && goal.id === task.goal.id ? 'selected' : '' %>>
              <%= goal.title %>
            </option>
          <% }) %>
        </select>
      </div>

      <!-- Tags Multi-select -->
      <div>
        <label for="tags" class="block font-semibold text-gray-700 mb-1">Select Tags</label>
        <select
          name="tags"
          id="tags"
          multiple
          class="w-full border border-gray-300 rounded-md px-3 py-2 h-32 focus:outline-none focus:ring-2 focus:ring-blue-500 hover:outline-1"
          required
        >
          <% tags.forEach(tag => { %>
            <option
              value="<%= tag.id %>"
              <%= editTaskForm && task.tags.some(tg => tg.id === tag.id) ? 'selected' : '' %>>
              <%= tag.name %>
            </option>
          <% }) %>
        </select>
      </div>

      <!-- Due Date -->
      <div>
        <label for="date" class="block font-semibold text-gray-700 mb-1">Due Date</label>
        <input
          type="datetime-local"
          id="date"
          name="date"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 hover:outline-1"
          value="<%= editTaskForm ? new Date(task.due_date).toISOString().slice(0, 16) : '' %>"
          required
        />
      </div>

      <!-- Submit Button -->
      <div>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition cursor-pointer"
        >
          <%= editTaskForm ? 'Update Task' : 'Create Task' %>
        </button>
      </div>
    </form>
  </div>
</div>
